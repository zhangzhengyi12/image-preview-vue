(function(e){function t(t){for(var n,r,c=t[0],s=t[1],l=t[2],d=0,u=[];d<c.length;d++)r=c[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);g&&g(t);while(u.length)u.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,c=1;c<a.length;c++){var s=a[c];0!==i[s]&&(n=!1)}n&&(o.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},i={index:0},o=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var g=s;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("c31f")},"18f0":function(e,t,a){},8539:function(e,t,a){"use strict";a("18f0")},"8a35":function(e,t,a){"use strict";a("f8ca")},ae78:function(e,t,a){},c31f:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.config,expression:"config"}],attrs:{rows:"20"},domProps:{value:e.config},on:{input:function(t){t.target.composing||(e.config=t.target.value)}}}),e._v(" "),a("div",{staticClass:"desc"},[e._v("尝试修改配置并点击下方按钮")]),a("div",{staticClass:"show",on:{click:e.handleTapImage}},[e._v("点我查看大图")])])},o=[],r={name:"App",data:function(){return{config:'\n{\n  "initIndex": 0,\n  "images": [\n    "https://yinodimage.oss-cn-hangzhou.aliyuncs.com/20200728221752.png"\n  ],\n  "isEnableBlurBackground": false,\n  "isEnableLoopToggle": true,\n  "initViewMode": "contain",\n  "containScale": 1,\n  "shirnkAndEnlargeDeltaRatio": 0.2,\n  "wheelScrollDeltaRatio": 0.2,\n  "isEnableImagePageIndicator": true,\n  "maskBackgroundColor": "rgba(0,0,0,0.6)",\n  "zIndex":4000,\n  "isEnableDownloadImage": true\n}\n      '}},methods:{handleTapImage:function(){var e={};try{e=JSON.parse(this.config)}catch(t){alert("JSON解析失败")}e.onClose=function(){console.log("preview has been closed")};this.$imagePreview(e)}}},c=r,s=(a("8539"),a("2877")),l=Object(s["a"])(c,i,o,!1,null,"44a43c3e",null),g=l.exports,d=a("5530"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"preview-anima"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"image-preview",style:"background-color:"+e.config.facade.maskBackgroundColor+";z-index:"+e.config.facade.zIndex},[e.config.facade.isEnableBlurBackground?a("div",{staticClass:"image-preview__blur-layer",style:"background-image:url("+e.core.cacheBlurImageUrl+")"}):e._e(),a("img",{class:["image-preview__image",e.imageStateClassName],style:e.imageStyle,attrs:{src:e.currentImageSrc,draggable:"false",alt:""},on:{load:e.handleImageLoaded,mousedown:e.handleImageDragStart,mouseup:e.handleImageDragEnd,mousemove:e.handleImageDragMove}}),a("div",{staticClass:"image-preview__action-layer"},[e.config.feature.isEnableImagePageIndicator?a("div",{staticClass:"image-preview__page-info"},[e._v(e._s(e.currentIndex+1)+"/"+e._s(e.core.images.length))]):e._e(),a("div",{staticClass:"image-preview__close image-preview__cir-action",on:{click:e.handleTapClose}},[a("i",{staticClass:"zip zipclose"})]),e.hasPrevImage?a("div",{staticClass:"image-preview__prev image-preview__cir-action",on:{click:e.handleTapPrev}},[a("i",{staticClass:"zip zipprev"})]):e._e(),e.hasNextImage?a("div",{staticClass:"image-preview__next image-preview__cir-action",on:{click:e.handleTapNext}},[a("i",{staticClass:"zip zipnext"})]):e._e(),a("div",{staticClass:"image-preview__action-bar"},[a("div",{staticClass:"image-preview__action-rotate-left action-btn image-preview__cir-action",on:{click:e.handleTapRotateLeft}},[a("i",{staticClass:"zip zipnishizhenxuanzhuan"})]),a("div",{staticClass:"image-preview__action-rotate-right action-btn image-preview__cir-action",on:{click:e.handleTapRotateRight}},[a("i",{staticClass:"zip zipshunshizhenxuanzhuan"})]),a("div",{staticClass:"image-preview__action-full-screen action-btn image-preview__cir-action",on:{click:e.handleTapfullscreen}},[a("i",{class:"zip "+(e.core.fullscreenMode?"zipadapt":"zipfull_screen")})]),a("div",{staticClass:"image-preview__action-scale-big action-btn image-preview__cir-action",on:{click:e.handleTapEnlarge}},[a("i",{staticClass:"zip zipfangda"})]),a("div",{staticClass:"image-preview__full-scale-small action-btn image-preview__cir-action",on:{click:e.handleTapShrink}},[a("i",{staticClass:"zip zipsuoxiao"})]),a("div",{class:["image-preview__horizontal-toggle","action-btn","image-preview__cir-action",{"is-active":e.core.isEnableHorizontalMirror}],on:{click:e.handleTapHorizontalToggle}},[a("i",{staticClass:"zip zipzuoyoufanzhuan_huaban1"})]),e.config.feature.isEnableDownloadImage?a("div",{staticClass:"image-preview__full-scale-small action-btn image-preview__cir-action",on:{click:e.handleTapDownload}},[a("i",{staticClass:"zip zipdown"})]):e._e()])])])])},h=[],f=(a("99af"),a("d4ec")),m=a("bee2"),p=function(){function e(t,a){var n=this;Object(f["a"])(this,e),this.deltaRatio=t,this.changeCallback=a,this.wheelScrollHandlerBindThis=function(e){n.wheelScrollHanlder(e)},this.initListener()}return Object(m["a"])(e,[{key:"initListener",value:function(){window.addEventListener("wheel",this.wheelScrollHandlerBindThis)}},{key:"removeListener",value:function(){window.removeEventListener("wheel",this.wheelScrollHandlerBindThis)}},{key:"wheelScrollHanlder",value:function(e){var t=e.deltaY,a=t>=0?1:-1,n=.1*this.deltaRatio;this.changeCallback(a*n)}}]),e}(),v=function(){function e(t,a){var n=this;Object(f["a"])(this,e),this.index=a,this.imageList=t,this.imageCacheList=Array(t.length),this.firstImageLoaded=!1,setTimeout((function(){n.onSomeImageUploaded()}),3e3)}return Object(m["a"])(e,[{key:"onSomeImageUploaded",value:function(){this.firstImageLoaded||(this.firstImageLoaded=!0,this.triggerPreLoading())}},{key:"updateIndex",value:function(e){this.index=e,this.triggerPreLoading()}},{key:"getPrevIndex",value:function(e){return 0===e?this.imageList.length-1:e-1}},{key:"getNextIndex",value:function(e){return e===this.imageList.length-1?0:e+1}},{key:"triggerPreLoading",value:function(){this.tryPreloadingByIndex(this.getPrevIndex(this.index)),this.tryPreloadingByIndex(this.getNextIndex(this.index))}},{key:"tryPreloadingByIndex",value:function(e){var t=this.imageCacheList[e];if(!t){var a=new Image;a.src=this.imageList[e],this.imageCacheList[e]=a}}}]),e}(),b=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),function(e,t){console.log(e),fetch(e).then((function(e){return e.blob()})).then((function(e){return URL.createObjectURL(e)})).then((function(e){var a=document.createElement("a");a.href=e,"function"===typeof t?(a.download=t(e),document.body.appendChild(a),a.click(),document.body.removeChild(a)):console.error("getImageFileName必须为函数，请检查参数")})).catch((function(e){return console.error(e)}))}),w=b;a("a15b"),a("d81d");function I(e,t){var a=t*(Math.PI/180),n=Math.cos(a),i=Math.sin(a);return"x"===e?[[1,0,0,0],[0,n,-n,0],[0,i,n,0],[0,0,0,1]]:"y"===e?[[n,0,i,0],[0,1,0,0],[-i,0,n,0],[0,0,0,1]]:[[n,-i,0,0],[i,n,0,0],[0,0,1,0],[0,0,0,1]]}function y(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}function S(e){return"matrix3d(".concat(e.map((function(e){return e.join(",")})).join(","),")")}function _(e,t){for(var a=0,n=0,i=e.length;n<i;n++)a+=e[n]*t[n];return a}function x(e,t){return e.map((function(e){return e[t]}))}function E(e,t){for(var a=[],n=0,i=e.length;n<i;n++){a[n]=[];for(var o=0,r=t[0].length;o<r;o++){var c=x(t,o),s=e[n];a[n].push(_(s,c))}}return a}var T={ROTATE:1,SCALE:2,DRAG:3},k={name:"zzy-image-preview",data:function(){return{visible:!1,core:{index:0,images:[],cacheBlurImageUrl:"",imageRotate:0,fullscreenMode:!1,scaleRatio:1,actionState:T.ROTATE,isEnableHorizontalMirror:!1},drag:{onDrag:!1,lastPageX:0,lastPageY:0,transformX:0,transformY:0},config:{facade:{isEnableBlurBackground:!1,maskBackgroundColor:"rgba(0,0,0,.4)",zIndex:100},feature:{isEnableLoopToggle:!1,isEnableImagePageIndicator:!0,wheelScrollDeltaRatio:1,shirnkAndEnlargeDelta:.2,containScale:1,isEnableDownloadImage:!1,getImageFileName:function(){}}}}},computed:{imageStateClassName:function(){return this.core.actionState===T.ROTATE?"is-rotate":this.core.actionState===T.SCALE?"is-scale":"is-drag"},currentIndex:function(){return this.config.feature.isEnableLoopToggle?Math.abs(this.core.index)%this.core.images.length:this.core.index},hasPrevImage:function(){return!!this.config.feature.isEnableLoopToggle||!!this.core.images[this.currentIndex-1]},hasNextImage:function(){return!!this.config.feature.isEnableLoopToggle||!!this.core.images[this.currentIndex+1]},currentImageSrc:function(){return this.core.images[this.currentIndex]},mirrorStyle:function(){var e=y();return this.core.isEnableHorizontalMirror&&(e=E(e,I("y",180))),S(e)},imageStyle:function(){var e="rotate(".concat(this.core.imageRotate,"deg)"),t="scale(".concat(this.core.scaleRatio,")"),a="translate(".concat(this.drag.transformX,"px,").concat(this.drag.transformY,"px)"),n=this.mirrorStyle,i="transform:".concat(a," ").concat(e," ").concat(t," ").concat(n,";"),o="object-fit: ".concat(this.core.fullscreenMode?"cover":"contain;",";");return i+o}},mounted:function(){this.visible=!0},methods:{initWithOptions:function(e){this.WheelScaleHandler=new p(e.wheelScrollDeltaRatio,this.handleWheelScrollChange),this.ImagePreloader=new v(e.images,e.initIndex),this.core.index=function(){return e.initIndex<0?0:e.initIndex>=e.images.length?e.images.length-1:e.initIndex}(),this.core.images=e.images,this.config.facade.isEnableBlurBackground=e.isEnableBlurBackground,this.config.feature.isEnableLoopToggle=e.isEnableLoopToggle,this.config.feature.isEnableImagePageIndicator=e.isEnableImagePageIndicator,this.config.feature.isEnableDownloadImage=e.isEnableDownloadImage,this.config.feature.getImageFileName=e.getImageFileName,this.core.fullscreenMode="contain"!==e.initViewMode,this.config.feature.shirnkAndEnlargeDeltaRatio=e.shirnkAndEnlargeDeltaRatio,this.config.feature.containScale=e.containScale,this.config.facade.maskBackgroundColor=e.maskBackgroundColor,this.config.facade.zIndex=e.zIndex,e.isEnableKeyboardShortcuts&&this.bindKeyboardShortcuts(),this.resetActionStyle()},bindKeyboardShortcuts:function(){window.addEventListener("keydown",this.onKeyboardKeyDown)},unbindKeyboardShortcuts:function(){window.removeEventListener("keydown",this.onKeyboardKeyDown)},onKeyboardKeyDown:function(e){var t=e.code,a=e.ctrlKey,n=e.metaKey;return"ArrowRight"===t?(this.toggleNext(),void e.preventDefault()):"ArrowLeft"===t?(this.togglePrev(),void e.preventDefault()):"Escape"===t?(this.handleTapClose(),void e.preventDefault()):"ArrowUp"===t?(this.handleTapEnlarge(),void e.preventDefault()):"ArrowDown"===t?(this.handleTapShrink(),void e.preventDefault()):"KeyS"===t&&(a||n)&&this.config.feature.isEnableDownloadImage?(this.handleTapDownload(),void e.preventDefault()):void 0},togglePrev:function(){this.core.index--,this.resetActionStyle(),this.ImagePreloader.updateIndex(this.currentIndex)},toggleNext:function(){this.core.index++,this.resetActionStyle(),this.ImagePreloader.updateIndex(this.currentIndex)},close:function(){var e=this;this.visible=!1,this.unbindKeyboardShortcuts(),setTimeout((function(){e.$emit("close"),e.$destroy(),e.$el.parentNode.removeChild(e.$el)}),300)},setScaleRatio:function(e){this.core.scaleRatio=e<.1?.1:e>5?5:e},resetActionStyle:function(){this.core.scaleRatio=1,this.drag.transformX=0,this.drag.transformY=0,this.core.fullscreenMode||this.setScaleRatio(this.config.feature.containScale)},handleImageLoaded:function(e){var t=this;this.$nextTick((function(){t.core.cacheBlurImageUrl=t.currentImageSrc})),this.ImagePreloader.onSomeImageUploaded()},handleTapClose:function(){this.close()},handleTapPrev:function(){this.togglePrev()},handleTapNext:function(){this.toggleNext()},handleTapRotateLeft:function(){this.core.actionState=T.ROTATE,this.core.imageRotate-=90},handleTapRotateRight:function(){this.core.actionState=T.ROTATE,this.core.imageRotate+=90},handleTapfullscreen:function(){this.core.fullscreenMode=!this.core.fullscreenMode,this.resetActionStyle()},handleWheelScrollChange:function(e){this.core.actionState=T.SCALE,this.setScaleRatio(this.core.scaleRatio-e)},handleTapShrink:function(){this.core.actionState=T.ROTATE,this.setScaleRatio(this.core.scaleRatio-this.config.feature.shirnkAndEnlargeDeltaRatio)},handleTapDownload:function(){w(this.currentImageSrc,this.config.feature.getImageFileName)},handleTapEnlarge:function(){this.core.actionState=T.ROTATE,this.setScaleRatio(this.core.scaleRatio+this.config.feature.shirnkAndEnlargeDeltaRatio)},handleTapHorizontalToggle:function(){this.core.actionState=T.ROTATE,this.core.isEnableHorizontalMirror=!this.core.isEnableHorizontalMirror},handleImageDragStart:function(e){0===e.button&&(this.drag.onDrag=!0,this.drag.lastPageX=e.pageX,this.drag.lastPageY=e.pageY)},handleImageDragMove:function(e){if(this.drag.onDrag){this.core.actionState=T.DRAG;var t=e.pageX-this.drag.lastPageX,a=e.pageY-this.drag.lastPageY;this.drag.transformX+=t,this.drag.transformY+=a,this.drag.lastPageX=e.pageX,this.drag.lastPageY=e.pageY}},handleImageDragEnd:function(e){this.drag.onDrag=!1,this.core.actionState=T.ROTATE}}},C=k,R=(a("8a35"),Object(s["a"])(C,u,h,!1,null,"04a34848",null)),z=R.exports,D=(a("ae78"),function(){}),P={initIndex:0,images:[],isEnableBlurBackground:!1,isEnableLoopToggle:!0,initViewMode:"contain",containScale:1,shirnkAndEnlargeDeltaRatio:.2,wheelScrollDeltaRatio:.2,isEnableImagePageIndicator:!0,maskBackgroundColor:"rgba(0,0,0,0.4)",onClose:D,zIndex:100,isEnableKeyboardShortcuts:!0,isEnableDownloadImage:!0,getImageFileName:function(){return String(Date.now())}},L=n["a"].extend(z);function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=new L;return t.initWithOptions(Object(d["a"])(Object(d["a"])({},P),e)),t.$mount(),document.body.appendChild(t.$el),t.$on("close",e.onClose),{$instance:t,close:t.close}}O.install=function(e){e.prototype.$imagePreview=O};var A=O;n["a"].config.productionTip=!1,n["a"].use(A),new n["a"]({render:function(e){return e(g)}}).$mount("#app")},f8ca:function(e,t,a){}});
//# sourceMappingURL=index.878c370b.js.map