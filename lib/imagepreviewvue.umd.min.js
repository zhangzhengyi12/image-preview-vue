(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("vue")):"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["imagepreviewvue"]=t(require("vue")):e["imagepreviewvue"]=t(e["Vue"])})("undefined"!==typeof self?self:this,(function(e){return function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fb15")}({"010f":function(e,t,i){"use strict";var a=i("6c6e"),n=i.n(a);n.a},"6c6e":function(e,t,i){},8875:function(e,t,i){var a,n,r;(function(i,s){n=[],a=s,r="function"===typeof a?a.apply(t,n):a,void 0===r||(e.exports=r)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(u){var i,a,n,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,s=/@([^@]*):(\d+):(\d+)\s*$/gi,o=r.exec(u.stack)||s.exec(u.stack),c=o&&o[1]||!1,l=o&&o[2]||!1,d=document.location.href.replace(document.location.hash,""),g=document.getElementsByTagName("script");c===d&&(i=document.documentElement.outerHTML,a=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),n=i.replace(a,"$1").trim());for(var h=0;h<g.length;h++){if("interactive"===g[h].readyState)return g[h];if(g[h].src===c)return g[h];if(c===d&&g[h].innerHTML&&g[h].innerHTML.trim()===n)return g[h]}return null}}return e}))},"8bbf":function(t,i){t.exports=e},ae78:function(e,t,i){},fb15:function(e,t,i){"use strict";if(i.r(t),"undefined"!==typeof window){var a=window.document.currentScript,n=i("8875");a=n(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:n});var r=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(i.p=r[1])}var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"preview-anima"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"image-preview"},[e.config.facade.isEnableBlurBackground?i("div",{staticClass:"image-preview__blur-layer",style:"background-image:url("+e.core.cacheBlurImageUrl+")"}):e._e(),i("img",{class:["image-preview__image",e.imageStateClassName],style:e.imageStyle,attrs:{src:e.currentImageSrc,draggable:"false",alt:""},on:{load:e.handleImageLoaded,mousedown:e.handleImageDragStart,mouseup:e.handleImageDragEnd,mousemove:e.handleImageDragMove}}),i("div",{staticClass:"image-preview__action-layer"},[e.config.feature.isEnableImagePageIndicator?i("div",{staticClass:"image-preview__page-info"},[e._v(e._s(e.currentIndex+1)+"/"+e._s(e.core.images.length))]):e._e(),i("div",{staticClass:"image-preview__close image-preview__cir-action",on:{click:e.handleTapClose}},[i("i",{staticClass:"zip zipclose"})]),e.hasPrevImage?i("div",{staticClass:"image-preview__prev image-preview__cir-action",on:{click:e.handleTapPrev}},[i("i",{staticClass:"zip zipprev"})]):e._e(),e.hasNextImage?i("div",{staticClass:"image-preview__next image-preview__cir-action",on:{click:e.handleTapNext}},[i("i",{staticClass:"zip zipnext"})]):e._e(),i("div",{staticClass:"image-preview__action-bar"},[i("div",{staticClass:"image-preview__action-rotate-left action-btn image-preview__cir-action",on:{click:e.handleTapRotateLeft}},[i("i",{staticClass:"zip zipnishizhenxuanzhuan"})]),i("div",{staticClass:"image-preview__action-rotate-right action-btn image-preview__cir-action",on:{click:e.handleTapRotateRight}},[i("i",{staticClass:"zip zipshunshizhenxuanzhuan"})]),i("div",{staticClass:"image-preview__action-full-screen action-btn image-preview__cir-action",on:{click:e.handleTapfullscreen}},[i("i",{class:"zip "+(e.core.fullscreenMode?"zipadapt":"zipfull_screen")})]),i("div",{staticClass:"image-preview__action-scale-big action-btn image-preview__cir-action",on:{click:e.handleTapEnlarge}},[i("i",{staticClass:"zip zipfangda"})]),i("div",{staticClass:"image-preview__full-scale-small action-btn image-preview__cir-action",on:{click:e.handleTapShrink}},[i("i",{staticClass:"zip zipsuoxiao"})])])])])])},o=[];class c{constructor(e,t){this.deltaRatio=e,this.changeCallback=t,this.wheelScrollHandlerBindThis=e=>{this.wheelScrollHanlder(e)},this.initListener()}initListener(){window.addEventListener("wheel",this.wheelScrollHandlerBindThis)}removeListener(){window.removeEventListener("wheel",this.wheelScrollHandlerBindThis)}wheelScrollHanlder({deltaY:e}){const t=e>=0?1:-1,i=.1*this.deltaRatio;this.changeCallback(t*i)}}class l{constructor(e,t){this.index=t,this.imageList=e,this.imageCacheList=Array(e.length),this.firstImageLoaded=!1,setTimeout(()=>{this.onSomeImageUploaded()},3e3)}onSomeImageUploaded(){this.firstImageLoaded||(this.firstImageLoaded=!0,this.triggerPreLoading())}updateIndex(e){this.index=e,this.triggerPreLoading()}getPrevIndex(e){return 0===e?this.imageList.length-1:e-1}getNextIndex(e){return e===this.imageList.length-1?0:e+1}triggerPreLoading(){this.tryPreloadingByIndex(this.getPrevIndex(this.index)),this.tryPreloadingByIndex(this.getNextIndex(this.index))}tryPreloadingByIndex(e){let t=this.imageCacheList[e];if(!t){let t=new Image;t.src=this.imageList[e],this.imageCacheList[e]=t}}}const d={ROTATE:1,SCALE:2,DRAG:3};var g={name:"zzy-image-preview",data(){return{visible:!1,core:{index:0,images:[],cacheBlurImageUrl:"",imageRotate:0,fullscreenMode:!1,scaleRatio:1,actionState:d.ROTATE},drag:{onDrag:!1,lastPageX:0,lastPageY:0,transformX:0,transformY:0},config:{facade:{isEnableBlurBackground:!1},feature:{isEnableLoopToggle:!1,isEnableImagePageIndicator:!0,wheelScrollDeltaRatio:1,shirnkAndEnlargeDelta:.2}}}},computed:{imageStateClassName(){return this.core.actionState===d.ROTATE?"is-rotate":this.core.actionState===d.SCALE?"is-scale":"is-drag"},currentIndex(){return this.config.feature.isEnableLoopToggle?Math.abs(this.core.index)%this.core.images.length:this.core.index},hasPrevImage(){return!!this.config.feature.isEnableLoopToggle||!!this.core.images[this.currentIndex-1]},hasNextImage(){return!!this.config.feature.isEnableLoopToggle||!!this.core.images[this.currentIndex+1]},currentImageSrc(){return this.core.images[this.currentIndex]},imageStyle(){const e=`rotate(${this.core.imageRotate}deg)`,t=`scale(${this.core.scaleRatio})`,i=`translate(${this.drag.transformX}px,${this.drag.transformY}px)`,a=`transform:${i} ${e} ${t} ;`,n=`object-fit: ${this.core.fullscreenMode?"cover":"contain;"};`;return a+n}},mounted(){this.visible=!0},methods:{initWithOptions(e){this.WheelScaleHandler=new c(e.wheelScrollDeltaRatio,this.handleWheelScrollChange),this.ImagePreloader=new l(e.images,e.initIndex),this.core.index=(()=>e.initIndex<0?0:e.initIndex>=e.images.length?e.images.length-1:e.initIndex)(),this.core.images=e.images,this.config.facade.isEnableBlurBackground=e.isEnableBlurBackground,this.config.feature.isEnableLoopToggle=e.isEnableLoopToggle,this.config.feature.isEnableImagePageIndicator=e.isEnableImagePageIndicator,this.core.fullscreenMode="contain"!==e.initViewMode,this.config.feature.shirnkAndEnlargeDeltaRatio=e.shirnkAndEnlargeDeltaRatio},togglePrev(){this.core.index--,this.resetActionStyle(),this.ImagePreloader.updateIndex(this.currentIndex)},toggleNext(){this.core.index++,this.resetActionStyle(),this.ImagePreloader.updateIndex(this.currentIndex)},close(){this.visible=!1,setTimeout(()=>{this.$destroy(),this.$el.parentNode.removeChild(this.$el)},300)},setScaleRatio(e){this.core.scaleRatio=e<.3?.3:e>5?5:e},resetActionStyle(){this.core.scaleRatio=1,this.drag.transformX=0,this.drag.transformY=0},handleImageLoaded(e){this.$nextTick(()=>{this.core.cacheBlurImageUrl=this.currentImageSrc}),this.ImagePreloader.onSomeImageUploaded()},handleTapClose(){this.close()},handleTapPrev(){this.togglePrev()},handleTapNext(){this.toggleNext()},handleTapRotateLeft(){this.core.actionState=d.ROTATE,this.core.imageRotate-=90},handleTapRotateRight(){this.core.actionState=d.ROTATE,this.core.imageRotate+=90},handleTapfullscreen(){this.resetActionStyle(),this.core.fullscreenMode=!this.core.fullscreenMode},handleWheelScrollChange(e){this.core.actionState=d.SCALE,this.setScaleRatio(this.core.scaleRatio-e)},handleTapShrink(){this.core.actionState=d.ROTATE,this.setScaleRatio(this.core.scaleRatio-this.config.feature.shirnkAndEnlargeDeltaRatio)},handleTapEnlarge(){this.core.actionState=d.ROTATE,this.setScaleRatio(this.core.scaleRatio+this.config.feature.shirnkAndEnlargeDeltaRatio)},handleImageDragStart(e){this.drag.onDrag=!0,this.drag.lastPageX=e.pageX,this.drag.lastPageY=e.pageY},handleImageDragMove(e){if(!this.drag.onDrag)return;this.core.actionState=d.DRAG;const t=e.pageX-this.drag.lastPageX,i=e.pageY-this.drag.lastPageY;this.drag.transformX+=t,this.drag.transformY+=i,this.drag.lastPageX=e.pageX,this.drag.lastPageY=e.pageY},handleImageDragEnd(e){this.drag.onDrag=!1,this.core.actionState=d.ROTATE}}},h=g;i("010f");function u(e,t,i,a,n,r,s,o){var c,l="function"===typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=i,l._compiled=!0),a&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),s?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},l._ssrRegister=c):n&&(c=o?function(){n.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:n),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(e,t){return c.call(t),d(e,t)}}else{var g=l.beforeCreate;l.beforeCreate=g?[].concat(g,c):[c]}return{exports:e,options:l}}var p=u(h,s,o,!1,null,"a393a546",null),m=p.exports,f=(i("ae78"),i("8bbf")),v=i.n(f);const _={initIndex:0,images:[],isEnableBlurBackground:!1,isEnableLoopToggle:!1,initViewMode:"contain",shirnkAndEnlargeDeltaRatio:.2,wheelScrollDeltaRatio:1,isEnableImagePageIndicator:!1},x=v.a.extend(m);function S(e=_){let t=new x;return t.initWithOptions({..._,...e}),t.$mount(),document.body.appendChild(t.$el),t}S.install=e=>{e.prototype.$previewImage=S};var b=S;t["default"]=b}})}));
//# sourceMappingURL=imagepreviewvue.umd.min.js.map